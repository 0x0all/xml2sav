<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html401/loose.dtd">
<html>
<!-- Created on December 5, 2016 by texi2html 1.82
texi2html was written by: 
            Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Many creative people.
Send bugs and suggestions to <texi2html-bug@nongnu.org>
-->
<head>
<title>Untitled Document</title>

<meta name="description" content="Untitled Document">
<meta name="keywords" content="Untitled Document">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="texi2html 1.82">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.smallquotation {font-size: smaller}
pre.display {font-family: serif}
pre.format {font-family: serif}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: serif; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: serif; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.roman {font-family:serif; font-weight:normal;}
span.sansserif {font-family:sans-serif; font-weight:normal;}
ul.toc {list-style: none}
-->
</style>


</head>

<body lang="en" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#800080" alink="#FF0000">

<a name="Data-Record"></a>
<a name="Data-Record-1"></a>
<h2 class="section">1. Data Record</h2>

<p>The data record must follow all other records in the system file.
Every system file must have a data record that specifies data for at
least one case.  The format of the data record varies depending on the
value of <code>compression</code> in the file header record:
</p>
<dl compact="compact">
<dt> 0: no compression</dt>
<dd><p>Data is arranged as a series of 8-byte elements.
Each element corresponds to
the variable declared in the respective variable record (@pxref{Variable
Record}).  Numeric values are given in <code>flt64</code> format; string
values are literal characters string, padded on the right when
necessary to fill out 8-byte units.
</p>
</dd>
<dt> 1: bytecode compression</dt>
<dd><p>The first 8 bytes
of the data record is divided into a series of 1-byte command
codes.  These codes have meanings as described below:
</p>
<dl compact="compact">
<dt> 0</dt>
<dd><p>Ignored.  If the program writing the system file accumulates compressed
data in blocks of fixed length, 0 bytes can be used to pad out extra
bytes remaining at the end of a fixed-size block.
</p>
</dd>
<dt> 1 through 251</dt>
<dd><p>A number with
value <var>code</var> - <var>bias</var>, where
<var>code</var> is the value of the compression code and <var>bias</var> is the
variable <code>bias</code> from the file header.  For example,
code 105 with bias 100.0 (the normal value) indicates a numeric variable
of value 5.
One file has been seen written by SPSS 14 that contained such a code
in a <em>string</em> field with the value 0 (after the bias is
subtracted) as a way of encoding null bytes.
</p>
</dd>
<dt> 252</dt>
<dd><p>End of file.  This code may or may not appear at the end of the data
stream.  PSPP always outputs this code but its use is not required.
</p>
</dd>
<dt> 253</dt>
<dd><p>A numeric or string value that is not
compressible.  The value is stored in the 8 bytes following the
current block of command bytes.  If this value appears twice in a block
of command bytes, then it indicates the second group of 8 bytes following the
command bytes, and so on.
</p>
</dd>
<dt> 254</dt>
<dd><p>An 8-byte string value that is all spaces.
</p>
</dd>
<dt> 255</dt>
<dd><p>The system-missing value.
</p></dd>
</dl>

<p>The end of the 8-byte group of bytecodes is followed by any 8-byte
blocks of non-compressible values indicated by code 253.  After that
follows another 8-byte group of bytecodes, then those bytecodes&rsquo;
non-compressible values.  The pattern repeats to the end of the file
or a code with value 252.
</p>
</dd>
<dt> 2: ZLIB compression</dt>
<dd><p>The data record consists of the following, in order:
</p>
<ul>
<li>
ZLIB data header, 24 bytes long.

</li><li>
One or more variable-length blocks of ZLIB compressed data.

</li><li>
ZLIB data trailer, with a 24-byte fixed header plus an additional 24
bytes for each preceding ZLIB compressed data block.
</li></ul>

<p>The ZLIB data header has the following format:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">int64               zheader_ofs;
int64               ztrailer_ofs;
int64               ztrailer_len;
</pre></td></tr></table>

<dl compact="compact">
<dt> <code>int64 zheader_ofs;</code></dt>
<dd><p>The offset, in bytes, of the beginning of this structure within the
system file.
</p>
</dd>
<dt> <code>int64 ztrailer_ofs;</code></dt>
<dd><p>The offset, in bytes, of the first byte of the ZLIB data trailer.
</p>
</dd>
<dt> <code>int64 ztrailer_len;</code></dt>
<dd><p>The number of bytes in the ZLIB data trailer.  This and the previous
field sum to the size of the system file in bytes.
</p></dd>
</dl>

<p>The data header is followed by <code>(ztrailer_ofs - 24) / 24</code> ZLIB
compressed data blocks.  Each ZLIB compressed data block begins with a
ZLIB header as specified in RFC&nbsp;1950, e.g. hex bytes <code>78
01</code> (the only header yet observed in practice).  Each block
decompresses to a fixed number of bytes (in practice only
<code>0x3ff000</code>-byte blocks have been observed), except that the last
block of data may be shorter.  The last ZLIB compressed data block
gends just before offset <code>ztrailer_ofs</code>.
</p>
<p>The result of ZLIB decompression is bytecode compressed data as
described above for compression format 1.
</p>
<p>The ZLIB data trailer begins with the following 24-byte fixed header:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">int64               bias;
int64               zero;
int32               block_size;
int32               n_blocks;
</pre></td></tr></table>

<dl compact="compact">
<dt> <code>int64 int_bias;</code></dt>
<dd><p>The compression bias as a negative integer, e.g. if <code>bias</code> in
the file header record is 100.0, then <code>int_bias</code> is -100
(this is the only value yet observed in practice).
</p>
</dd>
<dt> <code>int64 zero;</code></dt>
<dd><p>Always observed to be zero.
</p>
</dd>
<dt> <code>int32 block_size;</code></dt>
<dd><p>The number of bytes in each ZLIB compressed data block, except
possibly the last, following decompression.  Only <code>0x3ff000</code> has
been observed so far.
</p>
</dd>
<dt> <code>int32 n_blocks;</code></dt>
<dd><p>The number of ZLIB compressed data blocks, always exactly
<code>(ztrailer_ofs - 24) / 24</code>.
</p></dd>
</dl>

<p>The fixed header is followed by <code>n_blocks</code> 24-byte ZLIB data
block descriptors, each of which describes the compressed data block
corresponding to its offset.  Each block descriptor has the following
format:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">int64               uncompressed_ofs;
int64               compressed_ofs;
int32               uncompressed_size;
int32               compressed_size;
</pre></td></tr></table>

<dl compact="compact">
<dt> <code>int64 uncompressed_ofs;</code></dt>
<dd><p>The offset, in bytes, that this block of data would have in a similar
system file that uses compression format 1.  This is
<code>zheader_ofs</code> in the first block descriptor, and in each
succeeding block descriptor it is the sum of the previous desciptor&rsquo;s
<code>uncompressed_ofs</code> and <code>uncompressed_size</code>.
</p>
</dd>
<dt> <code>int64 compressed_ofs;</code></dt>
<dd><p>The offset, in bytes, of the actual beginning of this compressed data
block.  This is <code>zheader_ofs + 24</code> in the first block descriptor,
and in each succeeding block descriptor it is the sum of the previous
descriptor&rsquo;s <code>compressed_ofs</code> and <code>compressed_size</code>.  The
final block descriptor&rsquo;s <code>compressed_ofs</code> and
<code>compressed_size</code> sum to <code>ztrailer_ofs</code>.
</p>
</dd>
<dt> <code>int32 uncompressed_size;</code></dt>
<dd><p>The number of bytes in this data block, after decompression.  This is
<code>block_size</code> in every data block except the last, which may be
smaller.
</p>
</dd>
<dt> <code>int32 compressed_size;</code></dt>
<dd><p>The number of bytes in this data block, as stored compressed in this
system file.
</p></dd>
</dl>
</dd>
</dl>

<hr size="1">
<p>
 <font size="-1">
  This document was generated by <em>Joran Jessurun</em> on <em>December 5, 2016</em> using <a href="http://www.nongnu.org/texi2html/"><em>texi2html 1.82</em></a>.
 </font>
 <br>

</p>
</body>
</html>
